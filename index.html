// File: index.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel World Map</title>
    <!-- Подключаем стили Leaflet через CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Подключаем свои стили -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Контейнер для карты -->
    <div id="map"></div>
    <!-- Панель управления -->
    <div id="controls">
        <h2>Pixel World Map</h2>
        <div id="color-palette">
            <h3>Choose Color:</h3>
            <div class="color" style="background-color: #ff0000;" data-color="#ff0000"></div>
            <div class="color" style="background-color: #00ff00;" data-color="#00ff00"></div>
            <div class="color" style="background-color: #0000ff;" data-color="#0000ff"></div>
            <div class="color" style="background-color: #ffff00;" data-color="#ffff00"></div>
            <div class="color" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
            <div class="color" style="background-color: #00ffff;" data-color="#00ffff"></div>
            <div class="color" style="background-color: #ffffff;" data-color="#ffffff"></div>
            <div class="color" style="background-color: #000000;" data-color="#000000"></div>
        </div>
        <button id="place-pixel">Place Pixel</button>
        <p>Click on the map to select coordinates, then click "Place Pixel" to draw.</p>
        <p id="coords">Coordinates: N/A</p>
    </div>

    <!-- Подключаем библиотеки через CDN -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js"></script>
    <!-- Подключаем свой скрипт -->
    <script src="script.js"></script>
</body>
</html>

// File: style.css
/* Основные стили для страницы */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    overflow: hidden;
}

/* Стили для карты */
#map {
    flex: 1;
    height: 100%;
}

/* Стили для панели управления */
#controls {
    width: 250px;
    padding: 20px;
    background-color: #f4f4f4;
    border-left: 1px solid #ccc;
    box-sizing: border-box;
    overflow-y: auto;
}

#controls h2 {
    margin-top: 0;
    font-size: 1.5em;
    text-align: center;
}

#controls h3 {
    margin: 10px 0;
    font-size: 1.2em;
}

/* Стили для палитры цветов */
#color-palette {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.color {
    width: 40px;
    height: 40px;
    border: 2px solid #000;
    cursor: pointer;
    transition: transform 0.2s;
}

.color:hover {
    transform: scale(1.1);
}

.color.selected {
    border-color: #ffd700;
}

/* Стили для кнопки */
#place-pixel {
    width: 100%;
    padding: 10px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
}

#place-pixel:hover {
    background-color: #0056b3;
}

#place-pixel:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}

/* Стили для текста координат */
#coords {
    margin-top: 10px;
    font-size: 0.9em;
    color: #333;
}

/* Адаптивность для мобильных устройств */
@media (max-width: 768px) {
    body {
        flex-direction: column;
    }

    #controls {
        width: 100%;
        height: auto;
        border-left: none;
        border-top: 1px solid #ccc;
    }

    #map {
        height: 60%;
    }
}

// File: script.js
// Инициализация карты Leaflet
const map = L.map('map').setView([0, 0], 2); // Центр мира, начальный зум

// Добавляем тайлы OpenStreetMap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    maxZoom: 18,
    minZoom: 2
}).addTo(map);

// Инициализация Firebase
const firebaseConfig = {
    // Замените на свои настройки Firebase после создания проекта
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};

// Инициализация приложения Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const pixelsRef = database.ref('pixels');

// Переменные для управления
let selectedColor = '#ff0000'; // Цвет по умолчанию
let selectedCoords = null; // Выбранные координаты
const pixelSize = 0.01; // Размер пикселя в градусах (примерно 1 км на экваторе)

// Получаем элементы DOM
const colorElements = document.querySelectorAll('.color');
const placePixelButton = document.getElementById('place-pixel');
const coordsDisplay = document.getElementById('coords');

// Инициализация палитры цветов
colorElements.forEach(colorEl => {
    colorEl.addEventListener('click', () => {
        // Снимаем выделение с предыдущего цвета
        colorElements.forEach(el => el.classList.remove('selected'));
        // Выделяем выбранный цвет
        colorEl.classList.add('selected');
        selectedColor = colorEl.dataset.color;
    });
});

// Устанавливаем красный цвет как выбранный по умолчанию
document.querySelector('.color[data-color="#ff0000"]').classList.add('selected');

// Обработчик клика по карте для выбора координат
map.on('click', (e) => {
    selectedCoords = e.latlng;
    coordsDisplay.textContent = `Coordinates: Lat ${selectedCoords.lat.toFixed(4)}, Lng ${selectedCoords.lng.toFixed(4)}`;
    placePixelButton.disabled = false;
});

// Обработчик кнопки для размещения пикселя
placePixelButton.addEventListener('click', () => {
    if (selectedCoords) {
        const pixelKey = `${Math.round(selectedCoords.lat / pixelSize) * pixelSize}_${Math.round(selectedCoords.lng / pixelSize) * pixelSize}`;
        // Сохраняем пиксель в Firebase
        pixelsRef.child(pixelKey).set({
            lat: selectedCoords.lat,
            lng: selectedCoords.lng,
            color: selectedColor,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        // Сбрасываем выбор
        selectedCoords = null;
        coordsDisplay.textContent = 'Coordinates: N/A';
        placePixelButton.disabled = true;
    }
});

// Слой для пикселей
const pixelLayer = L.layerGroup().addTo(map);

// Слушаем изменения в базе данных Firebase
pixelsRef.on('child_added', (snapshot) => {
    const pixel = snapshot.val();
    addPixelToMap(pixel);
});

pixelsRef.on('child_changed', (snapshot) => {
    const pixel = snapshot.val();
    addPixelToMap(pixel);
});

// Функция для добавления пикселя на карту
function addPixelToMap(pixel) {
    const lat = pixel.lat;
    const lng = pixel.lng;
    const color = pixel.color;

    // Создаем прямоугольник (пиксель)
    const bounds = [
        [lat - pixelSize / 2, lng - pixelSize / 2],
        [lat + pixelSize / 2, lng + pixelSize / 2]
    ];
    const pixelKey = `${Math.round(lat / pixelSize) * pixelSize}_${Math.round(lng / pixelSize) * pixelSize}`;

    // Удаляем старый пиксель, если он существует
    if (pixelLayer[pixelKey]) {
        pixelLayer.removeLayer(pixelLayer[pixelKey]);
    }

    // Добавляем новый пиксель
    const rect = L.rectangle(bounds, {
        color: color,
        fillColor: color,
        fillOpacity: 1,
        weight: 1
    });
    pixelLayer[pixelKey] = rect;
    pixelLayer.addLayer(rect);
}

// Очистка старых пикселей (например, старше 24 часов, опционально)
setInterval(() => {
    const cutoff = Date.now() - 24 * 60 * 60 * 1000; // 24 часа назад
    pixelsRef.orderByChild('timestamp').endAt(cutoff).once('value', (snapshot) => {
        snapshot.forEach(child => {
            child.ref.remove();
            const pixel = child.val();
            const pixelKey = `${Math.round(pixel.lat / pixelSize) * pixelSize}_${Math.round(pixel.lng / pixelSize) * pixelSize}`;
            if (pixelLayer[pixelKey]) {
                pixelLayer.removeLayer(pixelLayer[pixelKey]);
                delete pixelLayer[pixelKey];
            }
        });
    });
}, 60 * 60 * 1000); // Проверять каждый час
